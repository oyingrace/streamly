!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var n=i();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}("undefined"!=typeof self?self:this,(function(){return function(){var t={8570:function(t){t.exports=n;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function n(t,i,n){this.low=0|t,this.high=0|i,this.unsigned=!!n}function r(t){return!0===(t&&t.__isLong__)}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var o={},e={};function u(t,i){var n,r,u;return i?(u=0<=(t>>>=0)&&t<256)&&(r=e[t])?r:(n=h(t,(0|t)<0?-1:0,!0),u&&(e[t]=n),n):(u=-128<=(t|=0)&&t<128)&&(r=o[t])?r:(n=h(t,t<0?-1:0,!1),u&&(o[t]=n),n)}function s(t,i){if(isNaN(t))return i?y:p;if(i){if(t<0)return y;if(t>=v)return T}else{if(t<=-d)return N;if(t+1>=d)return _}return t<0?s(-t,i).neg():h(t%l|0,t/l|0,i)}function h(t,i,r){return new n(t,i,r)}n.fromInt=u,n.fromNumber=s,n.fromBits=h;var f=Math.pow;function c(t,i,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return p;if("number"==typeof i?(n=i,i=!1):i=!!i,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return c(t.substring(1),i,n).neg();for(var o=s(f(n,8)),e=p,u=0;u<t.length;u+=8){var h=Math.min(8,t.length-u),a=parseInt(t.substring(u,u+h),n);if(h<8){var l=s(f(n,h));e=e.mul(l).add(s(a))}else e=(e=e.mul(o)).add(s(a))}return e.unsigned=i,e}function a(t,i){return"number"==typeof t?s(t,i):"string"==typeof t?c(t,i):h(t.low,t.high,"boolean"==typeof i?i:t.unsigned)}n.fromString=c,n.fromValue=a;var l=4294967296,v=l*l,d=v/2,m=u(1<<24),p=u(0);n.ZERO=p;var y=u(0,!0);n.UZERO=y;var w=u(1);n.ONE=w;var b=u(1,!0);n.UONE=b;var g=u(-1);n.NEG_ONE=g;var _=h(-1,2147483647,!1);n.MAX_VALUE=_;var T=h(-1,-1,!0);n.MAX_UNSIGNED_VALUE=T;var N=h(0,-2147483648,!1);n.MIN_VALUE=N;var O=n.prototype;O.toInt=function(){return this.unsigned?this.low>>>0:this.low},O.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},O.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(N)){var i=s(t),n=this.div(i),r=n.mul(i).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var o=s(f(t,6),this.unsigned),e=this,u="";;){var h=e.div(o),c=(e.sub(h.mul(o)).toInt()>>>0).toString(t);if((e=h).isZero())return c+u;for(;c.length<6;)c="0"+c;u=""+c+u}},O.getHighBits=function(){return this.high},O.getHighBitsUnsigned=function(){return this.high>>>0},O.getLowBits=function(){return this.low},O.getLowBitsUnsigned=function(){return this.low>>>0},O.getNumBitsAbs=function(){if(this.isNegative())return this.eq(N)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,i=31;i>0&&!(t&1<<i);i--);return 0!=this.high?i+33:i+1},O.isZero=function(){return 0===this.high&&0===this.low},O.eqz=O.isZero,O.isNegative=function(){return!this.unsigned&&this.high<0},O.isPositive=function(){return this.unsigned||this.high>=0},O.isOdd=function(){return!(1&~this.low)},O.isEven=function(){return!(1&this.low)},O.equals=function(t){return r(t)||(t=a(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},O.eq=O.equals,O.notEquals=function(t){return!this.eq(t)},O.neq=O.notEquals,O.ne=O.notEquals,O.lessThan=function(t){return this.comp(t)<0},O.lt=O.lessThan,O.lessThanOrEqual=function(t){return this.comp(t)<=0},O.lte=O.lessThanOrEqual,O.le=O.lessThanOrEqual,O.greaterThan=function(t){return this.comp(t)>0},O.gt=O.greaterThan,O.greaterThanOrEqual=function(t){return this.comp(t)>=0},O.gte=O.greaterThanOrEqual,O.ge=O.greaterThanOrEqual,O.compare=function(t){if(r(t)||(t=a(t)),this.eq(t))return 0;var i=this.isNegative(),n=t.isNegative();return i&&!n?-1:!i&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},O.comp=O.compare,O.negate=function(){return!this.unsigned&&this.eq(N)?N:this.not().add(w)},O.neg=O.negate,O.add=function(t){r(t)||(t=a(t));var i=0,n=0,o=0,e=0;return o+=(e+=(65535&this.low)+(65535&t.low))>>>16,n+=(o+=(this.low>>>16)+(t.low>>>16))>>>16,i+=(n+=(65535&this.high)+(65535&t.high))>>>16,i+=(this.high>>>16)+(t.high>>>16),h((o&=65535)<<16|(e&=65535),(i&=65535)<<16|(n&=65535),this.unsigned)},O.subtract=function(t){return r(t)||(t=a(t)),this.add(t.neg())},O.sub=O.subtract,O.multiply=function(t){if(this.isZero())return p;if(r(t)||(t=a(t)),i)return h(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned);if(t.isZero())return p;if(this.eq(N))return t.isOdd()?N:p;if(t.eq(N))return this.isOdd()?N:p;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(m)&&t.lt(m))return s(this.toNumber()*t.toNumber(),this.unsigned);var n=65535&this.high,o=this.low>>>16,e=65535&this.low,u=65535&t.high,f=t.low>>>16,c=65535&t.low,l=0,v=0,d=0,y=0;return d+=(y+=e*c)>>>16,v+=(d+=o*c)>>>16,d&=65535,v+=(d+=e*f)>>>16,l+=(v+=n*c)>>>16,v&=65535,l+=(v+=o*f)>>>16,v&=65535,l+=(v+=e*u)>>>16,l+=(this.high>>>16)*c+n*f+o*u+e*(t.high>>>16),h((d&=65535)<<16|(y&=65535),(l&=65535)<<16|(v&=65535),this.unsigned)},O.mul=O.multiply,O.divide=function(t){if(r(t)||(t=a(t)),t.isZero())throw Error("division by zero");var n,o,e;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?h((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:p;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return y;if(t.gt(this.shru(1)))return b;e=y}else{if(this.eq(N))return t.eq(w)||t.eq(g)?N:t.eq(N)?w:(n=this.shr(1).div(t).shl(1)).eq(p)?t.isNegative()?w:g:(o=this.sub(t.mul(n)),e=n.add(o.div(t)));if(t.eq(N))return this.unsigned?y:p;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();e=p}for(o=this;o.gte(t);){n=Math.max(1,Math.floor(o.toNumber()/t.toNumber()));for(var u=Math.ceil(Math.log(n)/Math.LN2),c=u<=48?1:f(2,u-48),l=s(n),v=l.mul(t);v.isNegative()||v.gt(o);)v=(l=s(n-=c,this.unsigned)).mul(t);l.isZero()&&(l=w),e=e.add(l),o=o.sub(v)}return e},O.div=O.divide,O.modulo=function(t){return r(t)||(t=a(t)),i?h((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},O.mod=O.modulo,O.rem=O.modulo,O.not=function(){return h(~this.low,~this.high,this.unsigned)},O.and=function(t){return r(t)||(t=a(t)),h(this.low&t.low,this.high&t.high,this.unsigned)},O.or=function(t){return r(t)||(t=a(t)),h(this.low|t.low,this.high|t.high,this.unsigned)},O.xor=function(t){return r(t)||(t=a(t)),h(this.low^t.low,this.high^t.high,this.unsigned)},O.shiftLeft=function(t){return r(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):h(0,this.low<<t-32,this.unsigned)},O.shl=O.shiftLeft,O.shiftRight=function(t){return r(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):h(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},O.shr=O.shiftRight,O.shiftRightUnsigned=function(t){if(r(t)&&(t=t.toInt()),0===(t&=63))return this;var i=this.high;return t<32?h(this.low>>>t|i<<32-t,i>>>t,this.unsigned):h(32===t?i:i>>>t-32,0,this.unsigned)},O.shru=O.shiftRightUnsigned,O.shr_u=O.shiftRightUnsigned,O.toSigned=function(){return this.unsigned?h(this.low,this.high,!1):this},O.toUnsigned=function(){return this.unsigned?this:h(this.low,this.high,!0)},O.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},O.toBytesLE=function(){var t=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},O.toBytesBE=function(){var t=this.high,i=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,i>>>24,i>>>16&255,i>>>8&255,255&i]},n.fromBytes=function(t,i,r){return r?n.fromBytesLE(t,i):n.fromBytesBE(t,i)},n.fromBytesLE=function(t,i){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,i)},n.fromBytesBE=function(t,i){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],i)}}},i={};function n(r){var o=i[r];if(void 0!==o)return o.exports;var e=i[r]={exports:{}};return t[r](e,e.exports,n),e.exports}n.d=function(t,i){for(var r in i)n.o(i,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:i[r]})},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return function(){"use strict";function t(t){return"number"==typeof t}function i(t){return void 0===t}function o(t){return null!==t&&t instanceof Object}function e(t){return t instanceof MediaStream}function u(t){return t instanceof HTMLVideoElement}function s(t){return t instanceof HTMLImageElement}n.r(r),n.d(r,{StreamCompositor:function(){return ft}});n(8570);var h={code:1100001,message:m},f={code:1103074,message:"video track is not readable"},c={code:1103076,message:"audio track is not readable"},a={code:1103077,message:"compositor blur not support."},l=Promise,v=document;var d="stream is not from zego",m="input param error";var p,y=function(){function t(t,i,n){this.t=t,this.i=i,this.u=n,this.fps=15,this.outputBitrate=1500,this.hasPortrait=!1,this.isClear=!1,this.canvasEl=v.createElement("canvas"),this.ctx=this.canvasEl.getContext("2d")}return t.prototype.setVideoConfig=function(t){var i=t.height,n=t.frameRate,r=t.bitrate;this.canvasEl.width=t.width,this.canvasEl.height=i,n&&(this.fps=n),r&&(this.outputBitrate=r)},t.prototype.setInputsOption=function(t){var i=this;this.isClear=!0,this.layers=t.filter((function(t){var i=t.stream,n=t.option,r=s(t.source),o=void 0!==n.contentType&&["ALL","VIDEO"].includes(n.contentType),e=!n.contentType||o,u=i&&i.getVideoTracks();if(0==(null==u?void 0:u.length)&&o)throw f;return r||e&&u&&(null==u?void 0:u.length)>0})).map((function(t){var n,r=t.source,o=t.stream,e=t.option;if(o&&"safari"===i.i.browser){var u=i.u.checkPreview(o);u.backgroundProcessor?(n=u.backgroundProcessor.getCanvas(),i.bgProcessor=u.backgroundProcessor,i.hasPortrait=!0):i.hasPortrait=!1}return{source:r,option:e,canvas:n}})),this.layers.sort((function(t,i){var n,r;return void 0!==(null===(n=t.option.layout)||void 0===n?void 0:n.zOrder)&&void 0!==(null===(r=i.option.layout)||void 0===r?void 0:r.zOrder)?t.option.layout.zOrder-i.option.layout.zOrder:-1}))},t.prototype.checkVideoInputs=function(t){var i=!0;return t.forEach((function(t){var n=t.stream,r=t.option,o=void 0!==r.contentType&&["ALL","VIDEO"].includes(r.contentType),e=n&&n.getVideoTracks();0==(null==e?void 0:e.length)&&o&&(i=!1)})),i},t.prototype.generateVideoTrack=function(){var t,i=this;if(this.hasPortrait?null===(t=this.bgProcessor)||void 0===t||t.setDrawBack((function(){i.draw()})):this.intervalId||(this.intervalId=setInterval((function(){i.draw()}),1e3/this.fps)),!this.canvasTrack){var n=this.canvasEl.captureStream("firefox"===this.i.browser?void 0:this.fps);this.canvasTrack=n.getVideoTracks()[0]}return this.canvasTrack},t.prototype.stopOutputStream=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.layers.forEach((function(t){t.source&&u(t.source)&&(t.source.pause(),t.source.remove(),t.source.srcObject=null,t.source=null)})),this.u.trackUtils.stopTrack(this.canvasTrack),this.canvasTrack=null,this.ctx=null,this.layers=[]},t.prototype.draw=function(){var t,i;if(this.ctx){this.ctx.clearRect(0,0,this.canvasEl.width,this.canvasEl.height);for(var n=0;n<this.layers.length;n++){var r=this.layers[n],o=r.source,e=r.option,h=r.canvas;if(e.layout){var f=e.layout,c=f.x,a=f.y,l=f.width,v=f.height,d=u(o)?o.videoWidth:s(o)?o.naturalWidth:0,m=u(o)?o.videoHeight:s(o)?o.naturalHeight:0;if(0==d||0==m)continue;var p=h||o;switch(e.objectFit){case"contain":if(l/v<=d/m){var y=(v-(b=l*m/d))/2;null===(t=this.ctx)||void 0===t||t.drawImage(p,c,a+y,l,b)}else{y=(l-(w=v*d/m))/2;null===(i=this.ctx)||void 0===i||i.drawImage(p,c+y,a,w,v)}break;case"cover":var w,b;if(l/v<=d/m)this.ctx.drawImage(p,(d-(w=l*m/v))/2,0,w,m,c,a,l,v);else this.ctx.drawImage(p,0,(m-(b=d*v/l))/2,d,b,c,a,l,v);break;case"fill":this.ctx.drawImage(p,c,a,l,v)}}}}},t}(),w=function(){function i(t,i,n){this.t=t,this.ac=i,this.u=n,this.inputs=[],this.descNode=this.ac.createMediaStreamDestination()}return i.prototype.setInputsOption=function(i){var n=this;this.inputs=i.filter((function(t){var i=t.stream,r=t.option,o=i&&i.getAudioTracks(),e=n.u.checkPreview(i),u=void 0!==r.contentType&&["ALL","AUDIO"].includes(r.contentType);if((0==(null==o?void 0:o.length)||(null==e?void 0:e.hasEmptyAudioTrack))&&u)throw c;return o&&(null==o?void 0:o.length)>0})),this.inputs.forEach((function(i){var n,r,o=i.audioNodes,e=i.option;(void 0===i.option.volume&&(i.option.volume=100),o)&&(!e.contentType||["ALL","AUDIO"].includes(e.contentType)?(!o.hasAudio&&(null===(n=null==o?void 0:o.srcNode)||void 0===n||n.connect(o.volumeNode)),o.hasAudio=!0,t(i.option.volume)&&(o.volumeNode.gain.value=i.option.volume/100)):(null===(r=null==o?void 0:o.srcNode)||void 0===r||r.disconnect(o.volumeNode),o.hasAudio=!1))}))},i.prototype.checkAudioInputs=function(t){var i=this,n=!0;return t.forEach((function(t){var r=t.stream,o=t.option,e=r&&r.getAudioTracks(),u=i.u.checkPreview(r),s=void 0!==o.contentType&&["ALL","AUDIO"].includes(o.contentType);(0==(null==e?void 0:e.length)||(null==u?void 0:u.hasEmptyAudioTrack))&&s&&(n=!1)})),n},i.prototype.generateAudioTrack=function(){for(var t,i=0;i<this.inputs.length;i++){var n=this.inputs[i],r=n.stream,o=n.option,e=!o.contentType||["ALL","AUDIO"].includes(o.contentType),u=this.createAudioNode(r,n.option.volume),s=u.srcNode,h=u.volumeNode;e&&(null==s||s.connect(h)),n.audioNodes={srcNode:s,volumeNode:h,hasAudio:e}}var f=null===(t=this.descNode)||void 0===t?void 0:t.stream.getAudioTracks();return f&&f.length>0?f[0]:(this.ac.resume(),null)},i.prototype.createAudioNode=function(t,i){var n=this.ac.createMediaStreamSource(t),r=this.ac.createGain();return r.gain.value=i/100,r.connect(this.descNode),{srcNode:n,volumeNode:r}},i.prototype.stopAudioCompositor=function(){for(var t=0;t<this.inputs.length;t++){var i=this.inputs[t],n=i.audioNodes,r=i.option;if(n){var o=n.srcNode,e=n.volumeNode;(!r.contentType||["ALL","AUDIO"].includes(r.contentType))&&(null==o||o.disconnect(e),null==e||e.disconnect(this.descNode)),n.volumeNode=null,n.srcNode=null}this.descNode=null}this.inputs=[]},i.prototype.replaceSource=function(t){var i=this;this.inputs.forEach((function(n){var r=n.stream,o=n.audioNodes;if(t===r&&o){var e=o.srcNode,u=o.volumeNode,s=o.hasAudio,h=i.ac.createMediaStreamSource(r);s&&(null==e||e.disconnect(u),h.connect(u)),o.srcNode=h}}))},i}();!function(t){t.STREAM_COMPOSITOR_MODULE="zc.scm.0"}(p||(p={}));var b=function(t){return t},g=function(t){return t},_={event:"/sdk/create_stream_zgp_compositor"},T={event:"/sdk/start_compositing_stream",error:{},media_stream_id:g,compose_stream_conf:b};var N,O,E="/sdk/init",I=E;!function(t){t[t.SWITCH_ONE=1]="SWITCH_ONE",t[t.SWITCH_TWO=2]="SWITCH_TWO"}(N||(N={})),function(t){t[t.ZegoGeoFenceTypeNone=0]="ZegoGeoFenceTypeNone",t[t.ZegoGeoFenceTypeInclude=1]="ZegoGeoFenceTypeInclude",t[t.ZegoGeoFenceTypeExclude=2]="ZegoGeoFenceTypeExclude"}(O||(O={}));var M,L;!function(t){t[t.TT_NONE=0]="TT_NONE",t[t.TT_PC=1]="TT_PC",t[t.TT_IOS=2]="TT_IOS",t[t.TT_ANDROID=3]="TT_ANDROID",t[t.TT_MAC=4]="TT_MAC",t[t.TT_LINUX=5]="TT_LINUX",t[t.TT_WEB=6]="TT_WEB",t[t.TT_MINIPROGRAM=7]="TT_MINIPROGRAM",t[t.TT_UNKNOWN=32]="TT_UNKNOWN"}(M||(M={})),function(t){t[t.disconnected=0]="disconnected",t[t.connecting=1]="connecting",t[t.connected=2]="connected"}(L||(L={}));var A,D,S,k;!function(t){t[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login"}(A||(A={})),function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}(D||(D={})),function(t){t[t.offline=0]="offline",t[t.online=1]="online"}(S||(S={})),function(t){t[t.NT_NONE=0]="NT_NONE",t[t.NT_LINE=1]="NT_LINE",t[t.NT_WIFI=2]="NT_WIFI",t[t.NT_2G=3]="NT_2G",t[t.NT_3G=4]="NT_3G",t[t.NT_4G=5]="NT_4G",t[t.NT_UNKNOWN=32]="NT_UNKNOWN"}(k||(k={}));var C;!function(t){t[t.debug=0]="debug",t[t.info=1]="info",t[t.warn=2]="warn",t[t.error=3]="error",t[t.report=99]="report",t[t.disable=100]="disable"}(C||(C={}));var j,x,W;!function(t){t[t.disable=0]="disable",t[t.websocket=1]="websocket",t[t.https=2]="https"}(j||(j={})),function(t){t[t.SDKProject_ZegoWebRTC=6]="SDKProject_ZegoWebRTC",t[t.SDKProject_ZegoMiniProgram=7]="SDKProject_ZegoMiniProgram"}(x||(x={})),function(t){t[t.UDP=0]="UDP",t[t.RTMP=1]="RTMP",t[t.FLV=2]="FLV",t[t.HLS=3]="HLS",t[t.WEBRTC=4]="WEBRTC"}(W||(W={}));var U,G;U=1,function(){var t=1}();!function(t){t[t.ClientType_None=0]="ClientType_None",t[t.ClientType_H5=1]="ClientType_H5",t[t.ClientType_SmallPragram=2]="ClientType_SmallPragram",t[t.ClientType_Webrtc=3]="ClientType_Webrtc"}(G||(G={}));var P,R,z,H,F,V,Q,K,Z,B,q,X,J;!function(t){t[t.Default=0]="Default",t[t.Extranet=1]="Extranet",t[t.Intranet=2]="Intranet"}(P||(P={})),function(t){t[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login"}(R||(R={})),function(t){t[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login",t[t.reconnect=3]="reconnect"}(z||(z={})),function(t){t[t.stop=0]="stop",t[t.start=1]="start"}(H||(H={})),function(t){t[t.CDN=0]="CDN",t[t.RTC=1]="RTC",t[t.L3=2]="L3",t[t.DG=3]="DG"}(F||(F={})),function(t){t[t.useAnalyzer=0]="useAnalyzer",t[t.useWorklet=1]="useWorklet"}(V||(V={})),function(t){t[t.Default=3]="Default",t[t.StandardVideoCall=4]="StandardVideoCall",t[t.HighVideoCall=5]="HighVideoCall",t[t.StandardChatroom=6]="StandardChatroom",t[t.HighQualityChatroom=7]="HighQualityChatroom",t[t.Broadcast=8]="Broadcast",t[t.Karaoke=9]="Karaoke",t[t.UNKNOWN=100]="UNKNOWN"}(Q||(Q={})),function(t){t.WIN32="WIN32",t.MAC="Mac",t.ANDROID="Android",t.LINUX="Linux",t.IOS="iOS",t.Harmony="Harmony",t.UNKNOWN="WTF"}(K||(K={})),function(t){t.CDN="cdn",t.L3="l3",t.RTC="rtc"}(Z||(Z={})),function(t){t[t.RTC=0]="RTC",t[t.CDN=1]="CDN",t[t.L3=2]="L3",t[t.DG=3]="DG",t[t.CUSTOM=5]="CUSTOM"}(B||(B={})),function(t){t[t.offline=0]="offline",t[t.online=1]="online"}(q||(q={})),function(t){t[t.MinQuality=0]="MinQuality",t[t.DieQuality=0]="DieQuality",t[t.PoorMinQuality=1]="PoorMinQuality",t[t.MiddleMinQuality=30]="MiddleMinQuality",t[t.GoodMinQuality=60]="GoodMinQuality",t[t.ExcellentMinQuality=85]="ExcellentMinQuality",t[t.MaxQuality=100]="MaxQuality"}(X||(X={})),function(t){t[t.Unknown=-1]="Unknown",t[t.Excellent=0]="Excellent",t[t.Good=1]="Good",t[t.Middle=2]="Middle",t[t.Poor=3]="Poor",t[t.Die=4]="Die"}(J||(J={}));var Y,$,tt=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.next=null,this.prev=null,this._id=t,this._data=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id?this._id:null},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!1,configurable:!0}),t.prototype.hasNext=function(){return this.next&&this.next.id},t.prototype.hasPrev=function(){return this.prev&&this.prev.id},t}();!function(){function t(){this.start=new tt,this.end=new tt,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}t.prototype.insertBefore=function(t,i){var n=new tt(this._idCounter,i);return n.next=t,n.prev=t.prev,t.prev&&(t.prev.next=n),t.prev=n,++this._idCounter,++this._numNodes,n},t.prototype.addLast=function(t){return this.insertBefore(this.end,t)},t.prototype.add=function(t){return this.addLast(t)},t.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},t.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},t.prototype.size=function(){return this._numNodes},t.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(t>=0)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},t.prototype.get=function(t){return 0===t?this.getFirst():t===this._numNodes-1?this.getLast():this.getFromFirst(t)},t.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this._numNodes,t},t.prototype.removeFirst=function(){var t=null;return this._numNodes>0&&this.start.next&&(t=this.remove(this.start.next)),t},t.prototype.removeLast=function(){var t=null;return this._numNodes>0&&this.end.prev&&(t=this.remove(this.end.prev)),t},t.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},t.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},t.prototype.find=function(t){for(var i=this.start,n=!1,r=null;i.hasNext()&&!n;)t(i=i.next)&&(r=i,n=!0);return r},t.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},t.prototype.push=function(t){return this.addLast(t)},t.prototype.unshift=function(t){this.insertBefore(this._numNodes>0?this.start.next:this.end,t)},t.prototype.pop=function(){return this.removeLast()},t.prototype.shift=function(){return this.removeFirst()}}();function it(){return navigator.userAgent||""}!function(t){t.ONLY_BASELINE="only_baseline",t.HARD_SOFT_ENCODEC_FIRST="hard_or_soft_encodec_first",t.HIGH_PROFILE_FIRST="high_profile_first"}(Y||(Y={})),function(t){t[t.None=0]="None",t[t.Vocalist=1]="Vocalist",t[t.BackingSinging=2]="BackingSinging"}($||($={}));var nt,rt=function(){return rt=Object.assign||function(t){for(var i,n=1,r=arguments.length;n<r;n++)for(var o in i=arguments[n])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t},rt.apply(this,arguments)},ot=function(t,i,n,r){return new(n||(n=Promise))((function(o,e){function u(t){try{h(r.next(t))}catch(t){e(t)}}function s(t){try{h(r.throw(t))}catch(t){e(t)}}function h(t){var i;t.done?o(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(u,s)}h((r=r.apply(t,i||[])).next())}))},et=function(t,i){var n,r,o,e,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function s(s){return function(h){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;e&&(e=0,s[0]&&(u=0)),u;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return u.label++,{value:s[1],done:!1};case 5:u.label++,r=s[1],s=[0];continue;case 7:s=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){u=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){u.label=s[1];break}if(6===s[0]&&u.label<o[1]){u.label=o[1],o=s;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(s);break}o[2]&&u.ops.pop(),u.trys.pop();continue}s=i.call(t,u)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,h])}}},ut=function(){function n(t,i,n,r){this.t=t,this.i=i,this.u=n,this.ac=r,this.mixOutputConfig={width:0,height:0,frameRate:15,bitrate:2500},this.inputStreamOptions=[],this.fit="cover",this.videoCompositor=new y(t,i,n),this.audioCompositor=new w(t,r,n)}return n.prototype.setOutputConfig=function(n){var r=n.height,o=n.frameRate,e=n.bitrate;if(!t(n.width))throw Error("param width error");if(!t(r))throw Error("param height error");if(!i(o)&&!t(o))throw Error("param frameRate error");if(!i(e)&&!t(e))throw Error("param bitrate error");this.mixOutputConfig=rt(rt({},this.mixOutputConfig),n),this.videoCompositor.setVideoConfig(this.mixOutputConfig)},n.prototype.setInputEndpoint=function(t,i){return ot(this,void 0,void 0,(function(){var n,r,o;return et(this,(function(u){switch(u.label){case 0:if(n=function(t,i){if(t&&!e(t)&&t.zegoStream){if(i.info("cu.gs type:zego"),e(t.stream))return t.stream;throw new Error("The ZegoLocalStream type requires first calling the capture api to capture the stream")}return t}(t,this.t),!this.checkStreamIsLocal(n))throw Error(d);return r=this.inputStreamOptions.find((function(t){return t.stream===n})),this.checkInputOption(i,!!r),r?(r.option=this.assignObj(r.option,i),[3,3]):[3,1];case 1:return[4,this.createVideo(n)];case 2:o=u.sent(),this.addInputLayer({source:o,stream:n,option:rt({objectFit:this.fit},i)}),u.label=3;case 3:if(!this.videoCompositor.checkVideoInputs(this.inputStreamOptions))throw f;if(!this.audioCompositor.checkAudioInputs(this.inputStreamOptions))throw c;return this.videoCompositor.setInputsOption(this.inputStreamOptions),this.audioCompositor.setInputsOption(this.inputStreamOptions),[2]}}))}))},n.prototype.addImage=function(t,i){this.checkImg(t);var n=this.inputStreamOptions.find((function(i){return i.source===t}));this.checkInputOption(i,!!n),n?n.option=this.assignObj(n.option,i):this.addInputLayer({source:t,option:rt({objectFit:this.fit},i)}),this.videoCompositor.setInputsOption(this.inputStreamOptions)},n.prototype.removeImage=function(t){this.checkImg(t);var i=this.inputStreamOptions.findIndex((function(i){return i.source===t}));i>0&&(this.inputStreamOptions.splice(i,1),this.videoCompositor.setInputsOption(this.inputStreamOptions))},n.prototype.startComposingStream=function(){var t=this;return new l((function(i,n){if(!t.checkOutputs())return t.t.error("zc.sc.scs.0 output config error"),void n(h);if(!t.checkInputs())return t.t.error("zc.sc.scs.0 input params error"),void n(h);if(!t.checkBrowserSupport())return t.t.error("zc.sc.scs.0 browser not support compositor"),void n(a);t.videoCompositor.setInputsOption(t.inputStreamOptions);var r=t.videoCompositor.generateVideoTrack();t.audioCompositor.setInputsOption(t.inputStreamOptions);var o=t.audioCompositor.generateAudioTrack();t.uploadEvent();var e=[r];o&&e.push(o);var u=new MediaStream(e);t.outputStream=u,t.u.createCompositingPreviewer(u,t.mixOutputConfig,t.inputStreamOptions),i(u)}))},n.prototype.stopComposingStream=function(){var t=this;return new l((function(i){var n,r;if(t.outputStream){var o=t.u.checkPreview(t.outputStream);o&&(null===(n=o.rtcViewer)||void 0===n||n.destroy(),o.streamCompositor=null,t.u.removePreview(o)),null===(r=t.outputStream)||void 0===r||r.getTracks().forEach((function(i){t.u.trackUtils.stopTrack(i)}))}try{t.videoCompositor.stopOutputStream(),t.audioCompositor.stopAudioCompositor()}catch(t){i(!1)}t.inputStreamOptions=[],i(!0)}))},n.prototype.checkInputs=function(){var t=this.mixOutputConfig,i=t.width,n=t.height;return this.inputStreamOptions.every((function(t){var r=t.option.layout;return r.x<=i&&r.y<=n&&r.x+r.width<=i&&r.y+r.height<=n&&r.width<=i&&r.height<=n}))},n.prototype.checkOutputs=function(){var t=this.mixOutputConfig;return t.width>0&&t.height>0&&t.frameRate>0&&t.bitrate>0},n.prototype.uploadEvent=function(){var t=this.i.reporter.createSpan(nt.H,{key:I},{key:""},T.event),i=this.inputStreamOptions.map((function(t){var i=t.option,n=i.layout,r=i.objectFit,o=i.contentType;return{content_control:"AUDIO"===o?1:"VIDEO"===o?2:0,x:n.x,y:n.y,w:n.width,h:n.height,order:n.zOrder,render_mode:"cover"===r?0:"contain"===r?1:2}})),n=this.mixOutputConfig;t.setAttributes({compose_stream_conf:T.compose_stream_conf({fps:n.frameRate,bitrate:n.bitrate,w:n.width,h:n.height,stream_cnt:i.length,input_stream_list:i})}),t.end()},n.prototype.checkImg=function(t){if(!t||!s(t)||!t.naturalWidth)throw this.t.error(p.STREAM_COMPOSITOR_MODULE+" source must be image and loaded"),Error("source must be image and loaded")},n.prototype.checkInputOption=function(t,n){var r=this,e=t.layout,u=t.objectFit,s=t.contentType;if(!i(e)){if(!o(e))throw Error("param layout error");["x","y","width","height"].forEach((function(t){r.checkNumParam(e,t,n)})),this.checkOptionalNumOptParam(e,"zOrder")}if(!i(u)&&!["cover","contain","fill"].includes(u))throw Error("param objectFit error");if(!i(s)&&!["ALL","VIDEO","AUDIO"].includes(s))throw Error("param contentType error");this.checkOptionalNumOptParam(t,"volume")},n.prototype.checkNumParam=function(i,n,r){if(r&&void 0===i[n]);else if(!t(i[n]))throw Error("param ".concat(n," error"))},n.prototype.checkOptionalNumOptParam=function(i,n){if(void 0!==i[n]&&!t(i[n]))throw Error("param ".concat(n," error"))},n.prototype.checkStreamIsLocal=function(t){var i=this.u.checkPreview(t),n=this.u.checkPlayer(t);return i&&(i.streamCompositor=this),!!i||!!n},n.prototype.addInputLayer=function(t){var i,n=t.option;void 0===(null===(i=n.layout)||void 0===i?void 0:i.zOrder)&&(n.layout.zOrder=0),this.inputStreamOptions.push(t)},n.prototype.createVideo=function(t){return ot(this,void 0,void 0,(function(){var i=this;return et(this,(function(n){return[2,new l((function(n,r){return ot(i,void 0,void 0,(function(){var i,o,e,u,s=this;return et(this,(function(h){return(i=v.createElement("video")).setAttribute("autoplay","autoplay"),i.setAttribute("muted","true"),i.muted=!0,i.setAttribute("playsinline","playsinline"),i.setAttribute("style","display:none"),o=null,e=function(){o&&(clearTimeout(o),o=null),i.play().catch((function(t){console.error(t)})),o=window.setTimeout((function(){s.t.warn("zc.sc.cv  video track error"),r(f)}),1e3)},u=function(){o&&clearTimeout(o),i&&i.removeEventListener("playing",u),n(i)},i&&i.addEventListener("playing",u),i.srcObject=t,i.play().catch((function(t){console.error(t)})),o=window.setTimeout((function(){e()}),1e3),[2]}))}))}))]}))}))},n.prototype.assignObj=function(t,i){void 0===t&&(t={});var n=t;if(!o(t)||!o(i))return i;for(var r in i)n[r]=t.hasOwnProperty(r)?this.assignObj(t[r],i[r]):i[r];return n},n.prototype.replaceSource=function(t){this.audioCompositor.replaceSource(t)},n.prototype.checkBrowserSupport=function(){var t=!0,i=function(){var t=it().toLowerCase().match(/cpu iphone os (.*?) like mac os/);return t&&t[1]||""}();return i&&i.includes("14_6")&&(t=!1),t},n}(),st=function(){function t(t){this.l=t}return t.prototype.addImage=function(t,i){this.l.addImage(t,i)},t.prototype.removeImage=function(t){this.l.removeImage(t)},t.prototype.setInputEndpoint=function(t,i){return this.l.setInputEndpoint(t,i)},t.prototype.setOutputConfig=function(t){this.l.setOutputConfig(t)},t.prototype.startComposingStream=function(){return this.l.startComposingStream()},t.prototype.stopComposingStream=function(){return this.l.stopComposingStream()},t}();!function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}(nt||(nt={}));var ht={createStreamCompositor:function(){var t=this.reporter.createSpan(nt.H,{key:I},{key:""},_.event),i=new ut(this.logger,this.stateCenter,this.streamCenter,this.ac);return t.end(),new st(i)}},ft={install:function(t){for(var i in ht)Object.defineProperty(t.prototype,i,{value:ht[i],writable:!1})},get type(){return"StreamCompositor"}}}(),r}()}));